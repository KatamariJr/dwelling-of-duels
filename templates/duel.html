{% extends "base.html" %}

{% block title %}{{ prettify_duel(objs[0]) }}{% endblock %}

{% block content %}

<h1 class="ctitle">
  {{ prettify_duel(objs[0]) }}

  <span class="duel-icons">
    {% if objs[0].has_archive %}
      <a href="http://dwellingofduels.net/{{ archive_dir }}/{{ objs[0].month_dir }}/{{ objs[0].month_dir }}.zip">
        <img src="/static/img/zip.svg" width="32px" height="32px" alt="ZIP Archive of Songs"/>
      </a>
    {% endif %}

    {% if objs[0].has_log %}
      <a href="http://dwellingofduels.net/{{ archive_dir }}/{{ objs[0].month_dir }}/{{ objs[0].month_dir }}.log">
        <img src="/static/img/log.svg" width="32px" height="32px" alt="Listening Party Log"/>
      </a>
    {% endif %}
  </span>
</h1>

<div class="hline-r"></div>

<br />

{% if objs[0].has_banner %}
  {% set banner_url = "http://dwellingofduels.net/" + archive_dir + "/" + objs[0].month_dir + "/" + objs[0].month_dir + ".jpg" %}

  <div class="centered">
    <a href="{{ banner_url }}" target="_blank">
      <img src="{{ banner_url }}"/>
    </a>
  </div>
{% endif %}

<br />
<br />

{% if not (voting and objs[0].month_dir == latest_month) %}
  <table class="table" data-sortable>
    <thead>
      <tr>
        <th>Play</th>
        <th data-sorted="true" data-sorted-direction="ascending">Rank</th>
        <th>Song</th>
        <th>Artist(s)</th>
        <th>Game(s)</th>
      </tr>
    </thead>
    <tbody>
    {% for obj in objs %}
      <tr {% if obj.rank|int < 4 %}class="{{ trophy_string(obj) }}-row"{% endif %}>
        <td>{{ get_player_button(obj) }}</td>
        <td {{ get_rank_sort_value(obj) }}>{{ get_rank(obj, false) }}</td>
        <td>{{ get_song_link(obj) }}</td>
        <td>{{ get_artist_link(obj) }}</td>
        <td>{{ get_game_link(obj) }}</td>
      </tr>
    {% endfor %}
    </tbody>
  </table>
{% endif %}

{% if voting and objs[0].month_dir == latest_month %}
  <h1 class="ctitle">Voting</h1>

  <div class="hline-r"></div>

  {% for obj in objs %}
    <h4 class="voting">
      {{ obj.games|join(', ') }} - {{ get_song_link(obj) }}
      <small class="pull-right">
        <label>
          <input type="checkbox" data-id="{{ loop.index0 }}"/> My Song
        </label>
      </small>
    </h4>

    <div class="voting-slider" data-id="{{ loop.index0 }}" data-song="{{ obj.games|join(', ') }} - {{ obj.title }}"></div>

    <br />
    <br />
  {% endfor %}

  <h1 class="ctitle">Your Votes</h1>

  <div class="hline-r"></div>

  <textarea id="voting-result" rows="{{ objs|length }}"></textarea>

  <p>Copy the text above and email it to <a href="mailto:dodsongs@gmail.com">dodsongs@gmail.com</a>
{% endif %}

{% endblock %}


{% block extra_js_includes %}
  <script type="text/javascript" src="/static/js/player.js"></script>

  {% if voting and objs[0].month_dir == latest_month %}
    <script type="text/javascript" src="/static/js/slider.js"></script>
    <script type="text/javascript" src="/static/js/voting.js"></script>
  {% endif %}
{% endblock %}
